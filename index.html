const NETLIFY_APP_URL = 'https://spontaneous-fenglisu-09c8c8.netlify.app';

async function startOAuth() {
    const state = Math.random().toString(36).substring(7);
    localStorage.setItem('oauth_state', state);
    
    const discordAuthUrl = `https://discord.com/api/oauth2/authorize?client_id=YOUR_CLIENT_ID&redirect_uri=${encodeURIComponent(NETLIFY_APP_URL + '/.netlify/functions/auth-callback')}&response_type=code&scope=identify&state=${state}`;
    window.location.href = discordAuthUrl;
}

// Check if we're returning from OAuth
window.addEventListener('load', function() {
    const urlParams = new URLSearchParams(window.location.search);
    const code = urlParams.get('code');
    
    if (code) {
        // We're on the callback page, process the code
        processOAuthCode(code);
    }
});

async function processOAuthCode(code) {
    try {
        const response = await fetch(`https://spontaneous-fenglisu-09c8c8.netlify.app/.netlify/functions/auth-callback?code=${code}`);
        const data = await response.json();
        
        const result = document.getElementById('result');
        result.style.display = 'block';
        
        if (data.success) {
            result.className = 'success';
            result.innerHTML = `
                <h3>Success!</h3>
                <p>Welcome, ${data.user.username}</p>
                <p>User ID: ${data.user.id}</p>
            `;
        } else {
            result.className = 'error';
            result.innerHTML = `<h3>Error:</h3><p>${data.error}</p>`;
        }
    } catch (error) {
        console.error('Error:', error);
    }
}
