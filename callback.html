<!DOCTYPE html>
<html>
<head>
    <title>OAuth Callback</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            text-align: center; 
            padding: 50px;
            background: #36393f;
            color: white;
        }
        .success { color: #43b581; }
        .error { color: #ed4245; }
    </style>
</head>
<body>
    <div id="status">
        <h1>Processing Authentication...</h1>
        <p>Saving your information...</p>
    </div>

    <script>
        // Parse the result from URL parameters
        const urlParams = new URLSearchParams(window.location.search);
        const result = urlParams.get('result');
        
        if (result) {
            try {
                const data = JSON.parse(decodeURIComponent(result));
                saveUserData(data);
            } catch (error) {
                showError('Error processing authentication');
            }
        } else {
            showError('No authentication data received');
        }

        function saveUserData(data) {
            if (data.success) {
                // Save to localStorage
                localStorage.setItem('discord_user', JSON.stringify(data.user));
                localStorage.setItem('discord_auth_time', new Date().toISOString());
                
                // Also save to sessionStorage for current session
                sessionStorage.setItem('current_discord_user', JSON.stringify(data.user));
                
                showSuccess(data.user);
            } else {
                showError(data.error);
            }
        }

        function showSuccess(user) {
            document.getElementById('status').innerHTML = `
                <h1 class="success">✅ Authentication Successful!</h1>
                <p>Welcome, <strong>${user.username}</strong>!</p>
                <p>Email: ${user.email}</p>
                <p>User ID: ${user.id}</p>
                <p>Your information has been saved.</p>
                <button onclick="goToDashboard()">Go to Dashboard</button>
                <br><br>
                <small>Data saved to browser storage. Will persist until you clear browser data.</small>
            `;
        }

        function showError(message) {
            document.getElementById('status').innerHTML = `
                <h1 class="error">❌ Authentication Failed</h1>
                <p>${message}</p>
                <button onclick="retryLogin()">Try Again</button>
            `;
        }

        function goToDashboard() {
            // Redirect to your main app
            window.location.href = 'https://spontaneous-fenglisu-09c8c8.netlify.app/index.html';
        }

        function retryLogin() {
            window.location.href = 'https://spontaneous-fenglisu-09c8c8.netlify.app/index.html';
        }
    </script>
</body>
</html>
